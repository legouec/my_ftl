/*
** container.c for  in /home/naniev/ETNA/FDI-DEVC/my_ftl/legoue_c
** 
** Made by LEGOUEST Clement
** Login   <legoue_c@etna-alternance.net>
** 
** Started on  Mon Nov  6 21:18:00 2017 LEGOUEST Clement
** Last update Wed Nov  8 12:00:14 2017 LEGOUEST Clement
*/

#include <stdlib.h>
#include "container.h"
#include "my_string.h"

int	add_container_to_ship(t_ship *ship)
{
  t_container	*container;

  my_putstr("Ajout du container en cours...\n");
  container = malloc(sizeof(t_container));
  if (container == NULL)
    {
      my_putstr("Votre vaisseau a explose lorsque vous");
      my_putstr("avez pose le container.\n");
      return(0);
    }
  my_putstr("Le container a ete ajoute avec succes!\n");
  container->first = NULL;
  container->last = NULL;
  container->nb_elem = 0;
  ship->container = container;
  return(1);
}

void	add_freight_to_container(t_ship *ship, t_freight *freight)
{
  if ((ship == NULL) || (freight == NULL))
    return;
  if ((ship->container->first == NULL) && (ship->container->last == NULL))
    {
      ship->container->first = freight;
      ship->container->last = freight;
      freight->next = NULL;
      freight->prev = NULL;
    }
  else
    {
      ship->container->last->next = freight;
      freight->prev = ship->container->last;
      freight->next = NULL;
      ship->container->last = freight;
    }
  ship->container->nb_elem += 1;
}

void	del_freight_from_container(t_ship *ship, t_freight *freight)
{
  if ((ship == NULL) || (freight == NULL) || (ship->container->nb_elem == 0))
    return;
  if (freight == ship->container->first)
      first = first->next;
  else if (freight == ship->container->last)
    last = last->prev;
  else
    {
      freight->prev->next = freight->next;
      freight->next->prev = freight->prev;
    }
  free (freight->item);
  free (freight);
}

void	get_bonus(t_ship *ship)
{
  while (ship->container->first != NULL)
    {
      if (my_strcmp(ship->container->first->item, "attackbonus"))
	{
	  ship->weapon->damage += 5;
	  my_putstr("Les armes ont ete ameliorees.\n");
	  del_freight_from_container(ship, ship->container->first);
	}
      if (my_strcmp(ship->container->first->item, "evadebonus"))
	{
	  ship->navigation_tools->evade += 3;
	  my_putstr("Vous gagnez un bonus de furtivite.\n");
	  del_freight_from_container(ship, ship->container->first);
	}
      if (my_strcmp(ship->container->first->item, "energy"))
	{
	  ship->ftl_drive->energy += 1;
	  my_putstr("Ajout d'energie au reacteur.\n");
	  del_freight_from_container(ship, ship->container->first);
	}
      if (my_strcmp(ship->container->first->item, "scrap"))
	{
	  my_putstr("DÃ©bris sans interet reperes, evacuation immediate.\n");
	  del_freight_from_container(ship, ship->container->first);
	  return;
	}
      else
	return;
    }
  return;
}
